! Leaf3 Configuration for EVPN VXLAN
! This router acts as VTEP and connects to Host3
! NOTE: Create L2 bridge/vxlan in Linux (br10 + vxlan10). This file keeps FRR routing only.

! Enable required daemons
zebra=yes
bgpd=yes
ospfd=yes

! Zebra configuration
interface eth0
 ip address 10.1.3.2/30
interface lo
 ip address 1.1.1.4/32

 
! OSPF configuration for underlay
router ospf
 router-id 1.1.1.4
 network 10.1.3.0/30 area 0
 network 1.1.1.4/32 area 0
!

! BGP configuration
router bgp 1
 bgp router-id 1.1.1.4
 no bgp ebgp-requires-policy
 neighbor 1.1.1.1 remote-as 1
 neighbor 1.1.1.1 update-source lo
 !
 address-family l2vpn evpn
  neighbor 1.1.1.1 activate
  advertise-all-vni
  vni 10
   rd 1.1.1.4:10
   route-target import 1:10
   route-target export 1:10
 exit-address-family
!

/sbin/ip link del vxlan10 2>/dev/null || true
/sbin/ip link set br10 down 2>/dev/null || true
/usr/sbin/brctl delbr br10 2>/dev/null || true

/sbin/ip addr flush dev eth1
/usr/sbin/brctl addbr br10
/usr/sbin/brctl addif br10 eth1
/sbin/ip link set br10 up
/sbin/ip link set eth1 up

/sbin/ip link add vxlan10 type vxlan id 10 dev eth0 local 1.1.1.4 dstport 4789 nolearning
/sbin/ip link set vxlan10 up
/usr/sbin/brctl addif br10 vxlan10

/sbin/ip -d link show vxlan10
/sbin/bridge link | grep 'master br10'